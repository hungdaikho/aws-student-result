"use strict";(()=>{var e={};e.id=6049,e.ids=[6049],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6302:e=>{e.exports=require("xlsx")},6120:(e,i,t)=>{t.r(i),t.d(i,{originalPathname:()=>p,patchFetch:()=>f,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>u});var n={};t.r(n),t.d(n,{POST:()=>l});var s=t(3278),o=t(5002),r=t(4877),a=t(1309);async function l(e){try{console.log("\uD83D\uDCE5 Analyze Excel request received");let i=await e.formData(),n=i.get("excel"),s=i.get("examType");if(!n)return a.NextResponse.json({success:!1,error:"Aucun fichier fourni"},{status:400});console.log("\uD83D\uDCC4 File details:",{name:n.name,size:n.size,type:n.type});let o=Buffer.from(await n.arrayBuffer()),r=await Promise.resolve().then(t.t.bind(t,6302,23)),l=r.read(o,{type:"buffer"}),c=l.SheetNames[0],d=l.Sheets[c],u=r.utils.sheet_to_json(d,{header:1});if(0===u.length)return a.NextResponse.json({success:!1,error:"Le fichier Excel est vide"},{status:400});let m=u[0],p=m.map((e,i)=>null==e||""===e?`Colonne_${i+1}`:String(e).trim())?.filter(e=>e&&""!==e);console.log("\uD83D\uDCCA Raw headers:",m),console.log("\uD83D\uDCCA Cleaned headers:",p);let f=u.slice(1)?.filter(e=>!!Array.isArray(e)&&e.some(e=>null!=e&&""!==e));if(console.log("\uD83D\uDCCA Excel analysis:",{totalRows:f.length,columns:p.length,headers:p.slice(0,10)}),0===p.length)return a.NextResponse.json({success:!1,error:"Aucune colonne valide trouv\xe9e dans le fichier"},{status:400});if(0===f.length)return a.NextResponse.json({success:!1,error:"Aucune donn\xe9e trouv\xe9e dans le fichier"},{status:400});let g=f.slice(0,3).map(e=>{let i={};return p.forEach((t,n)=>{let s=e[n];i[t]=null!=s?String(s):""}),i}),y={};for(let[e,i]of Object.entries({matricule:["nodoss","matricule","numero","dossier","id","num","num_bac","num_bepc"],nom_complet:["nompl","nom_prenom","nom_complet","nom","prenom","fullname","nom_fr"],section:["serie","section","filiere","specialite","branch"],moyenne:["moybac","moyenne","moy","note","score","average","moy_bac","moyenne_bepc"],score:["score","note","total","points","resultat","moyenne"],ecole:["libnoets","ecole","lycee","etablissement_origine","school","libnoetce","centre"],etablissement:["libnoetce","etablissement","institution","centre","etablissement_fr"],wilaya:["wilaya","province","region","gouvernorat","wilaya_fr"],moughataa:["moughataa","centre","district","moughata","moughataa_fr","centre_examen"],decision:["decision","resultat","statut","admis","result"],date_naissance:["date_naissance","naissance","birth","birthday","date_naiss","datn"]}))for(let t of p){if(!t||"string"!=typeof t)continue;let n=t?.toLowerCase().trim();for(let s of i){let i=s?.toLowerCase();if((n===i||n?.includes(i)||i?.includes(n))&&!y[e]){y[e]=t,console.log(`ðŸŽ¯ Matched ${e} -> ${t} (pattern: ${s})`);break}}if(y[e])break}console.log("\uD83C\uDFAF Final suggested mapping:",y);let h={success:!0,fileName:n.name,fileSize:n.size,examType:s,columns:p,sampleData:g,totalRows:f.length,requiredFields:"BAC"===s?[{field:"matricule",description:"Num\xe9ro de dossier/matricule de l'\xe9tudiant"},{field:"nom_complet",description:"Nom et pr\xe9nom complet de l'\xe9tudiant"},{field:"section",description:"Section/S\xe9rie (ex: Sciences Exp\xe9rimentales, Math\xe9matiques, etc.)"},{field:"moyenne",description:"Moyenne g\xe9n\xe9rale du BAC"},{field:"ecole",description:"\xc9cole/Lyc\xe9e d'origine"},{field:"etablissement",description:"\xc9tablissement/Institution"},{field:"wilaya",description:"Wilaya/Province"},{field:"decision",description:"D\xe9cision finale (Admis/Non admis)"},{field:"date_naissance",description:"Date de naissance (optionnel)"}]:"CONCOURS"===s?[{field:"matricule",description:"Num\xe9ro de dossier/matricule de l'\xe9tudiant"},{field:"nom_complet",description:"Nom et pr\xe9nom complet de l'\xe9tudiant"},{field:"score",description:"Score obtenu au concours"},{field:"ecole",description:"\xc9cole/Lyc\xe9e d'origine"},{field:"etablissement",description:"\xc9tablissement/Institution"},{field:"wilaya",description:"Wilaya/Province"},{field:"moughataa",description:"Moughataa/Centre (pour identifier l'\xe9tudiant de mani\xe8re unique)"},{field:"date_naissance",description:"Date de naissance (optionnel)"}]:[{field:"matricule",description:"Num\xe9ro de dossier/matricule de l'\xe9tudiant"},{field:"nom_complet",description:"Nom et pr\xe9nom complet de l'\xe9tudiant"},{field:"moyenne",description:"Moyenne g\xe9n\xe9rale du BREVET"},{field:"ecole",description:"\xc9cole/Coll\xe8ge d'origine"},{field:"etablissement",description:"\xc9tablissement/Institution"},{field:"wilaya",description:"Wilaya/Province"},{field:"decision",description:"D\xe9cision finale (Admis/Non admis)"},{field:"date_naissance",description:"Date de naissance (optionnel)"}],suggestedMapping:y};return a.NextResponse.json(h)}catch(i){console.error("\uD83D\uDCA5 Analyze Excel error:",i);let e="Erreur lors de l'analyse du fichier Excel";return i instanceof Error&&(console.error("Error details:",{name:i.name,message:i.message,stack:i.stack?.split("\n").slice(0,5)}),e=i.message?.includes("Unsupported file")?"Format de fichier non support\xe9. Veuillez utiliser un fichier Excel (.xlsx ou .xls)":i.message?.includes("Invalid file")?"Fichier Excel invalide ou corrompu":i.message?.includes("Cannot read properties")?"Erreur de lecture du fichier Excel. V\xe9rifiez que le fichier contient des donn\xe9es valides.":`Erreur d'analyse: ${i.message}`),a.NextResponse.json({success:!1,error:e,details:i instanceof Error?i.message:"Unknown error"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/analyze-excel/route",pathname:"/api/admin/analyze-excel",filename:"route",bundlePath:"app/api/admin/analyze-excel/route"},resolvedPagePath:"D:\\WORK\\FREELANCER\\student-result-upgraded\\app\\api\\admin\\analyze-excel\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:d,staticGenerationAsyncStorage:u,serverHooks:m}=c,p="/api/admin/analyze-excel/route";function f(){return(0,r.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:u})}}};var i=require("../../../../webpack-runtime.js");i.C(e);var t=e=>i(i.s=e),n=i.X(0,[9379,4833],()=>t(6120));module.exports=n})();
"use strict";(()=>{var e={};e.id=7687,e.ids=[7687],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4980:(e,i,t)=>{t.r(i),t.d(i,{originalPathname:()=>x,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p});var n={};t.r(n),t.d(n,{GET:()=>l,dynamic:()=>d});var s=t(3278),r=t(5002),a=t(4877),o=t(1309),c=t(4738);let d="force-dynamic";async function l(e){try{let i=e.nextUrl.searchParams,t=Number.parseInt(i.get("year")||"2024"),n=i.get("examType")||"BAC",s=Number.parseInt(i.get("limit")||"50");console.log(`ðŸ” Debug admis logic for ${n} ${t}`);let r=await c._.student.findMany({where:{year:t,examType:n},select:{matricule:!0,nom_complet:!0,etablissement:!0,decision_text:!0,admis:!0,moyenne:!0,rang:!0},orderBy:{rang:"asc"},take:s}),a=r.map(e=>{let i=function(e){if(!e||"string"!=typeof e)return!1;let i=e.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ");return!!(i.includes("admis")||i.includes("reussi")||i.includes("reussie")||i.includes("success")||"r"===i||"a"===i||i.includes("pass")||i.includes("valide"))||!(i.includes("sessionnaire")||i.includes("sessionn")||i.includes("session")||i.includes("rattrapage"))&&(i.includes("echec")||i.includes("echoue")||i.includes("refuse")||i.includes("elimine")||i.includes("ajourne")||i.includes("fail")||i.includes("reject"),!1)}(e.decision_text),t=e.admis!==i;return{matricule:e.matricule,nom_complet:e.nom_complet,etablissement:e.etablissement,decision_text:e.decision_text,admis_in_db:e.admis,should_be_admitted:i,is_inconsistent:t,moyenne:e.moyenne,rang:e.rang}}),d=r.length,l=r.filter(e=>e.admis).length,u=a.filter(e=>e.should_be_admitted).length,m=a.filter(e=>e.is_inconsistent).length,p={totalStudents:d,admittedInDb:l,shouldBeAdmitted:u,inconsistentRecords:m,inconsistencyRate:d>0?(m/d*100).toFixed(1):"0.0",dbAdmissionRate:d>0?(l/d*100).toFixed(1):"0.0",textBasedAdmissionRate:d>0?(u/d*100).toFixed(1):"0.0"},g=a.filter(e=>e.is_inconsistent).slice(0,10),x=[...new Set(r.map(e=>e.decision_text))].sort();return o.NextResponse.json({year:t,examType:n,summary:p,uniqueDecisionTexts:x,inconsistentSamples:g,sampleData:a.slice(0,20)})}catch(e){return console.error("\uD83D\uDCA5 Debug admis error:",e),o.NextResponse.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/admin/debug-admis/route",pathname:"/api/admin/debug-admis",filename:"route",bundlePath:"app/api/admin/debug-admis/route"},resolvedPagePath:"D:\\WORK\\FREELANCER\\student-result-upgraded\\app\\api\\admin\\debug-admis\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:g}=u,x="/api/admin/debug-admis/route";function h(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}},4738:(e,i,t)=>{t.d(i,{_:()=>r});var n=t(3524);let s=globalThis,r=(()=>{if(process.env.DATABASE_URL)return s.prisma??new n.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}},__internal:{engine:{connectionLimit:5,queryTimeout:15e3,connectionTimeout:5e3,pool:{min:1,max:5,acquireTimeoutMillis:15e3,createTimeoutMillis:15e3,destroyTimeoutMillis:3e3,idleTimeoutMillis:15e3,reapIntervalMillis:500,createRetryIntervalMillis:100}}}})})();r&&process.on("beforeExit",async()=>{try{await Promise.race([r.$disconnect(),new Promise(e=>setTimeout(e,5e3))])}catch(e){console.error("Error disconnecting Prisma:",e)}}),process.on("uncaughtException",async e=>{console.error("Uncaught Exception:",e);try{r&&await r.$disconnect()}catch(e){console.error("Error disconnecting Prisma on uncaught exception:",e)}process.exit(1)})}};var i=require("../../../../webpack-runtime.js");i.C(e);var t=e=>i(i.s=e),n=i.X(0,[9379,4833],()=>t(4980));module.exports=n})();
"use strict";(()=>{var e={};e.id=6949,e.ids=[6949],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4854:(e,a,n)=>{n.r(a),n.d(a,{originalPathname:()=>g,patchFetch:()=>k,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var t={};n.r(t),n.d(t,{POST:()=>i});var r=n(3278),s=n(5002),o=n(4877),l=n(1309);let u=new(n(3524)).PrismaClient;async function i(e){try{console.log("\uD83D\uDD04 Recalculate ranks request received");let{year:a,examType:n}=await e.json();if(!a||!n)return l.NextResponse.json({error:"Year and examType are required"},{status:400});console.log(`ðŸ”„ Recalculating ranks for ${n} ${a}`);let t=await u.student.findMany({where:{year:parseInt(a),examType:n},orderBy:[{moyenne:"desc"},{matricule:"asc"}],select:{id:!0,matricule:!0,moyenne:!0,rang:!0}});if(0===t.length)return l.NextResponse.json({success:!0,message:"No students found for the specified year and exam type",updatedCount:0});console.log(`ðŸ“Š Found ${t.length} students to rerank`);let r=t.map((e,a)=>({id:e.id,oldRank:e.rang,newRank:a+1,matricule:e.matricule,moyenne:e.moyenne})).filter(e=>e.oldRank!==e.newRank);console.log(`ðŸ”„ ${r.length} students need rank updates`);let s=0;return r.length>0&&await u.$transaction(async e=>{for(let a of r)await e.student.update({where:{id:a.id},data:{rang:a.newRank}}),s++}),r.length>0&&(console.log("\uD83D\uDCCA Sample rank changes:"),r.slice(0,5).forEach(e=>{console.log(`  ${e.matricule}: ${e.oldRank} â†’ ${e.newRank} (score: ${e.moyenne})`)})),l.NextResponse.json({success:!0,message:`Ranks recalculated successfully. ${s} students updated.`,totalStudents:t.length,updatedCount:s,samples:r.slice(0,10).map(e=>({matricule:e.matricule,moyenne:e.moyenne,oldRank:e.oldRank,newRank:e.newRank}))})}catch(e){return console.error("âŒ Error recalculating ranks:",e),l.NextResponse.json({error:"Erreur lors du recalcul des rangs",details:e.message},{status:500})}}let c=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/recalculate-ranks/route",pathname:"/api/admin/recalculate-ranks",filename:"route",bundlePath:"app/api/admin/recalculate-ranks/route"},resolvedPagePath:"D:\\WORK\\FREELANCER\\student-result-upgraded\\app\\api\\admin\\recalculate-ranks\\route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:m}=c,g="/api/admin/recalculate-ranks/route";function k(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}}};var a=require("../../../../webpack-runtime.js");a.C(e);var n=e=>a(a.s=e),t=a.X(0,[9379,4833],()=>n(4854));module.exports=t})();
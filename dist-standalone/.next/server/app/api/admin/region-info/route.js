"use strict";(()=>{var e={};e.id=389,e.ids=[389],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5801:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var o={};n.r(o),n.d(o,{GET:()=>c});var r=n(3278),i=n(5002),a=n(4877),s=n(1309),u=n(4738);async function c(e){try{console.log("\uD83D\uDCCD Region info request received");let[e,t,n]=await Promise.all([u._.student.groupBy({by:["wilaya"],_count:!0,_avg:{moyenne:!0}}),u._.student.groupBy({by:["etablissement"],_count:!0,_avg:{moyenne:!0}}),u._.student.count()]),o=e.map(e=>({wilaya:e.wilaya,studentCount:e._count,averageScore:e._avg.moyenne?Number(e._avg.moyenne.toFixed(2)):0,percentage:n>0?Number((e._count/n*100).toFixed(2)):0})).sort((e,t)=>t.studentCount-e.studentCount),r=t.map(e=>({school:e.etablissement,studentCount:e._count,averageScore:e._avg.moyenne?Number(e._avg.moyenne.toFixed(2)):0,percentage:n>0?Number((e._count/n*100).toFixed(2)):0})).sort((e,t)=>t.studentCount-e.studentCount).slice(0,50),i={totalStudents:n,totalWilayas:o.length,totalSchools:r.length,topWilaya:o.length>0?o[0]:null,topSchool:r.length>0?r[0]:null};return s.NextResponse.json({status:"SUCCESS",summary:i,wilayas:o,schools:r,timestamp:new Date().toISOString()})}catch(e){return console.error("âŒ Region info error:",e),s.NextResponse.json({status:"ERROR",error:"Failed to retrieve region information",details:e instanceof Error?e.message:"Unknown error",configured:!!process.env.DATABASE_URL,timestamp:new Date().toISOString()},{status:500})}}let l=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/region-info/route",pathname:"/api/admin/region-info",filename:"route",bundlePath:"app/api/admin/region-info/route"},resolvedPagePath:"D:\\WORK\\FREELANCER\\student-result-upgraded\\app\\api\\admin\\region-info\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m}=l,g="/api/admin/region-info/route";function y(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},4738:(e,t,n)=>{n.d(t,{_:()=>i});var o=n(3524);let r=globalThis,i=(()=>{if(process.env.DATABASE_URL)return r.prisma??new o.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}},__internal:{engine:{connectionLimit:5,queryTimeout:15e3,connectionTimeout:5e3,pool:{min:1,max:5,acquireTimeoutMillis:15e3,createTimeoutMillis:15e3,destroyTimeoutMillis:3e3,idleTimeoutMillis:15e3,reapIntervalMillis:500,createRetryIntervalMillis:100}}}})})();i&&process.on("beforeExit",async()=>{try{await Promise.race([i.$disconnect(),new Promise(e=>setTimeout(e,5e3))])}catch(e){console.error("Error disconnecting Prisma:",e)}}),process.on("uncaughtException",async e=>{console.error("Uncaught Exception:",e);try{i&&await i.$disconnect()}catch(e){console.error("Error disconnecting Prisma on uncaught exception:",e)}process.exit(1)})}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),o=t.X(0,[9379,4833],()=>n(5801));module.exports=o})();
"use strict";(()=>{var e={};e.id=365,e.ids=[365],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9688:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>c});var n={};r.r(n),r.d(n,{GET:()=>m});var o=r(3278),a=r(5002),i=r(4877),s=r(1309);let d=new(r(3524)).PrismaClient;async function m(e){try{let t=e.nextUrl.searchParams,r=t.get("school"),n=parseInt(t.get("year")||"2024"),o=t.get("examType")||"BAC";if(!r)return s.NextResponse.json({error:"School name is required"},{status:400});let a=await d.student.findMany({where:{ecole:r,year:n,examType:o},select:{matricule:!0,nom_complet:!0,moyenne:!0,admis:!0,section:!0,rang:!0}}),i=a.length,m=a.filter(e=>e.admis).length,u=a.filter(e=>!e.admis).length,l=i>0?(m/i*100).toFixed(1):"0.0",c=a.filter(e=>e.admis).slice(0,5),p=a.filter(e=>!e.admis).slice(0,5),g=a.reduce((e,t)=>{let r=t.section||"Unknown";return e[r]||(e[r]={total:0,admitted:0,notAdmitted:0}),e[r].total++,t.admis?e[r].admitted++:e[r].notAdmitted++,e},{});return s.NextResponse.json({schoolName:r,year:n,examType:o,totalStudents:i,admittedStudents:m,notAdmittedStudents:u,admissionRate:Number(l),sectionBreakdown:g,samples:{admitted:c.map(e=>({matricule:e.matricule,nom:e.nom_complet,moyenne:e.moyenne,admis:e.admis,section:e.section})),notAdmitted:p.map(e=>({matricule:e.matricule,nom:e.nom_complet,moyenne:e.moyenne,admis:e.admis,section:e.section}))}})}catch(e){return console.error("âŒ Error in debug API:",e),s.NextResponse.json({error:"Server error",details:e.message},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/debug-school/route",pathname:"/api/admin/debug-school",filename:"route",bundlePath:"app/api/admin/debug-school/route"},resolvedPagePath:"D:\\WORK\\FREELANCER\\student-result-upgraded\\app\\api\\admin\\debug-school\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:p}=u,g="/api/admin/debug-school/route";function h(){return(0,i.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:c})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9379,4833],()=>r(9688));module.exports=n})();
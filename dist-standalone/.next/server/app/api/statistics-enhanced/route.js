"use strict";(()=>{var e={};e.id=7085,e.ids=[7085],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1581:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var n={};a.r(n),a.d(n,{GET:()=>d});var s=a(3278),i=a(5002),r=a(4877),o=a(1309);let u=new(a(3524)).PrismaClient;async function d(e){try{let{searchParams:t}=new URL(e.url),a=parseInt(t.get("year")||"2025"),n=t.get("examType")||"BAC",s=t.get("sessionType"),i={year:a,examType:n};"BAC"===n&&s&&(i.sessionType=s);let r=await u.student.count({where:i}),d=await u.student.count({where:{...i,admis:!0}}),c=await u.student.aggregate({where:i,_avg:{moyenne:!0}}),p=await u.student.groupBy({by:["etablissement"],where:i,_count:{id:!0},_avg:{moyenne:!0}}),l=await u.student.groupBy({by:["etablissement"],where:{...i,admis:!0},_count:{id:!0}}),m=new Map(l.map(e=>[e.etablissement,e._count.id])),y=p.filter(e=>e._count.id>30).map(e=>{let t=m.get(e.etablissement)||0;return{name:e.etablissement,totalStudents:e._count.id,admittedStudents:t,successRate:e._count.id>0?t/e._count.id*100:0,averageScore:e._avg.moyenne||0}}).sort((e,t)=>t.successRate-e.successRate),g=y.slice(0,5),w=y.slice(-5).reverse(),h=[];if("BAC"===n){let e=await u.student.groupBy({by:["section"],where:{year:a,examType:n},_count:{id:!0}}),t=await u.student.groupBy({by:["section"],where:{year:a,examType:n,admis:!0},_count:{id:!0}}),s=new Map(t.map(e=>[e.section,e._count.id]));h=e.map(e=>{let t=s.get(e.section)||0;return{name:e.section,total:e._count.id,admitted:t,rate:e._count.id>0?(t/e._count.id*100).toFixed(1):"0.0"}})}let _=await u.student.groupBy({by:["wilaya"],where:{year:a,examType:n},_count:{id:!0}}),x=await u.student.groupBy({by:["wilaya"],where:{year:a,examType:n,admis:!0},_count:{id:!0}}),v=new Map(x.map(e=>[e.wilaya,e._count.id])),b=_.filter(e=>e.wilaya).map(e=>{let t=v.get(e.wilaya)||0;return{name:e.wilaya,total:e._count.id,admitted:t,rate:e._count.id>0?(t/e._count.id*100).toFixed(1):"0.0"}}).sort((e,t)=>parseFloat(t.rate)-parseFloat(e.rate)),R={success:!0,basicStats:{totalStudents:r,admittedStudents:d,admissionRate:r>0?(d/r*100).toFixed(1):"0.0",averageScore:c._avg.moyenne?c._avg.moyenne.toFixed(2):"0.00"},schoolStats:{top5Schools:g,bottom5Schools:w},sectionStats:h,wilayaStats:b,year:a,examType:n};return o.NextResponse.json(R)}catch(e){return console.error("Error fetching enhanced statistics:",e),o.NextResponse.json({error:"Failed to fetch enhanced statistics"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/statistics-enhanced/route",pathname:"/api/statistics-enhanced",filename:"route",bundlePath:"app/api/statistics-enhanced/route"},resolvedPagePath:"D:\\WORK\\FREELANCER\\student-result-upgraded\\app\\api\\statistics-enhanced\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:l,serverHooks:m}=c,y="/api/statistics-enhanced/route";function g(){return(0,r.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[9379,4833],()=>a(1581));module.exports=n})();